/*
 * This code is distributed under the license: MIT License
 * Originally written by Zhenrong WANG
 * mailto: zhenrongwang@live.com
 */


#include <stdio.h>
#include <math.h>
#include "if97_general.h"
#include "region_calc.h"
#include "region3.h"

const double region3_coeff[40][4]={
	1,0,0,0.10658070028513e1,
	2,0,0,-0.15732845290239e2,
	3,0,1,0.20944396974307e2,
	4,0,2,-0.76867707878716e1,
	5,0,7,0.26185947787954e1,
	6,0,10,-0.28080781148620e1,
	7,0,12,0.12053369696517e1,
	8,0,23,-0.84566812812502e-2,
	9,1,2,-0.12654315477714e1,
	10,1,6,-0.11524407806681e1,
	11,1,15,0.88521043984318,
	12,1,17,-0.64207765181607,
	13,2,0,0.38493460186671,
	14,2,2,-0.85214708824206,
	15,2,6,0.48972281541877e1,
	16,2,7,-0.30502617256965e1,
	17,2,22,0.39420536879154e-1,
	18,2,26,0.12558408424308,
	19,3,0,-0.27999329698710,
	20,3,2,0.13899799569460e1,
	21,3,4,-0.20189915023570e1,
	22,3,16,-0.82147637173963e-2,
	23,3,26,-0.47596035734923,
	24,4,0,0.43984074473500e-1,
	25,4,2,-0.44476435428739,
	26,4,4,0.90572070719733,
	27,4,26,0.70522450087967,
	28,5,1,0.10770512626332,
	29,5,3,-0.32913623258954,
	30,5,26,-0.50871062041158,
	31,6,0,-0.22175400873096e-1,
	32,6,2,0.94260751665092e-1,
	33,6,26,0.16436278447961,
	34,7,2,-0.13503372241348e-1,
	35,8,26,-0.14834345352472e-1,
	36,9,2,0.57922953628084e-3,
	37,9,26,0.32308904703711e-2,
	38,10,0,0.80964802996215e-4,
	39,10,1,-0.16557679795037e-3,
	40,11,26,-0.44923899061815e-4
};

const double t3ab[5][2]={
	0,0.154793642129415e4,
	1,-0.187661219490113e3,
	2,0.213144632222113e2,
	-1,-0.191887498864292e4,
	-2,0.918419702359447e3,
};

const double t3cd[4][2]={
	0,0.585276966696349e3,
	1,0.278233532206915e1,
	2,-0.127283549295878e-1,
	3,0.159090746562729e-3,
};

const double t3gh[5][2]={
	0,-0.249284240900418e5,
	1,0.428143584791546e4,
	2,-0.269029173140130e3,
	3,0.751608051114157e1,
	4,-0.787105249910383e-1,
};

const double t3ij[5][2]={
	0,0.584814781649163e3,
	1,-0.616179320924617,
	2,0.260763050899562,
	3,-0.587071076864459e-2,
	4,0.515308185433082e-4
};

const double t3jk[5][2]={
	0,0.617229772068439e3,
	1,-0.770600270141675e1,
	2,0.697072596851896,
	3,-0.157391839848015e-1,
	4,0.137897492684194e-3,
};

const double t3mn[4][2]={
	0,0.535339483742384e3,
	1,0.761978122720128e1,
	2,-0.158365725441648,
	3,0.192871054508108e-2,
};

const double t3op[5][2]={
	0,0.969461372400213e3,
	1,-0.332500170441278e3,
	2,0.642859598466067e2,
	-1,0.773845935768222e3,
	-2,-0.152313732937084e4,
};

const double t3qu[4][2]={
	0,0.565603648239126e3,
	1,0.529062258221222e1,
	2,-0.102020639611016,
	3,0.122240301070145e-2,
};

const double t3rx[4][2]={
	0,0.584561202520006e3,
	1,-0.102961025163669e1,
	2,0.243293362700452,
	3,-0.294905044740799e-2,
};

const double sat_coeff_r3[10]={
	0.11670521452767e4,
	-0.72421316703206e6,
	-0.17073846940092e2,
	0.12020824702470e5,
	-0.32325550322333e7,
	0.14915108613530e2,
	-0.48232657361591e4,
	0.40511340542057e6,
	-0.23855557567849,
	0.65017534844798e3,
};

const double t3uv[4][2]={
	0,0.528199646263062e3,
	1,0.890579602135307e1,
	2,-0.222814134903755,
	3,0.286791682263697e-2,
};

const double t3wx[5][2]={
	0,0.728052609145380e1,
	1,0.973505869861952e2,
	2,0.147370491183191e2,
	-1,0.329196213998375e3,
	-2,0.873371668682417e3,
};

const double v3a[3][30]={
-12,-12,-12,-10,-10,-10,-8,-8,-8,-6,-5,-5,-5,-4,-3,-3,-3,-3,-2,-2,-2,-1,-1,-1,0,0,1,1,2,2,
5,10,12,5,10,12,5,8,10,1,1,5,10,8,0,1,3,6,0,2,3,0,1,2,0,1,0,2,0,2,
0.110879558823853e-2,0.572616740810616e3,-0.767051948380852e5,-0.253321069529674e-1,0.628008049345689e4,0.234105654131876e6,0.216867826045856,-0.156237904341963e3,-0.269893956176613e5,-0.180407100085505e-3,0.116732227668261e-2,0.266987040856040e2,0.282776617243286e5,-0.242431520029523e4,0.435217323022733e-3,-0.122494831387441e-1,0.179357604019989e1,0.442729521058314e2,-0.593223489018342e-2,0.453186261685774,0.135825703129140e1,0.408748415856745e-1,0.474686397863312,0.118646814997915e1,0.546987265727549,0.195266770452643,-0.502268790869663e-1,-0.369645308193377,0.633828037528420e-2,0.797441793901017e-1,
};

const double v3b[3][32]={
-12,-12,-10,-10,-8,-6,-6,-6,-5,-5,-5,-4,-4,-4,-3,-3,-3,-3,-3,-2,-2,-2,-1,-1,0,0,1,1,2,3,4,4,
10,12,8,14,8,5,6,8,5,8,10,2,4,5,0,1,2,3,5,0,2,5,0,2,0,1,0,2,0,2,0,1,
-0.827670470003621e-1,0.416887126010565e2,0.483651982197059e-1,-0.291032084950276e5,-0.111422582236948e3,-0.202300083904014e-1,0.294002509338515e3,0.140244997609658e3,-0.344384158811459e3,0.361182452612149e3,-0.140699677420738e4,-0.202023902676481e-2,0.171346792457471e3,-0.425597804058632e1,0.691346085000334e-5,0.151140509678925e-2,-0.416375290166236e-1,-0.413754957011042e2,-0.506673295721637e2,-0.572212965569023e-3,0.608817368401785e1,0.239600660256161e2,0.122261479925384e-1,0.216356057692938e1,0.398198903368642,-0.116892827834085,-0.102845919373532,-0.492676637589284,0.655540456406790e-1,-0.240462535078530,-0.269798180310075e-1,0.128369435967012,
};

const double v3c[3][35]={
-12,-12,-12,-10,-10,-10,-8,-8,-8,-6,-5,-5,-5,-4,-4,-3,-3,-2,-2,-2,-1,-1,-1,0,0,0,1,1,2,2,2,2,3,3,8,
6,8,10,6,8,10,5,6,7,8,1,4,7,2,8,0,3,0,4,5,0,1,2,0,1,2,0,2,0,1,3,7,0,7,1,
3.11967788763030,2.76713458847564E+04,3.22583103403269E+07,-3.42416065095363E+02,-8.99732529907377E+05,-7.93892049821251E+07,9.53193003217388E+01,2.29784742345072E+03,1.75336675322499E+05,7.91214365222792E+06,3.19933345844209E-05,-6.59508863555767E+01,-8.33426563212851E+05,6.45734680583292E-02,-3.82031020570813E+06,4.06398848470079E-05,3.10327498492008E+01,-8.92996718483724E-04,2.34604891591616E+02,3.77515668966951E+03,1.58646812591361E-02,7.07906336241843E-01,1.26016225146570E+01,7.36143655772152E-01,6.76544268999101E-01,-1.78100588189137E+01,-1.56531975531713E-01,1.17707430048158E+01,8.40143653860447E-02,-1.86442467471949E-01,-4.40170203949645E+01,1.23290423502494E+06,-2.40650039730845E-02,-1.07077716660869E+06,4.38319858566475E-02,
};

const double v3d[3][38]={
-12,-12,-12,-12,-12,-12,-10,-10,-10,-10,-10,-10,-10,-8,-8,-8,-8,-6,-6,-5,-5,-5,-5,-4,-4,-4,-3,-3,-2,-2,-1,-1,-1,0,0,1,1,3,
4,6,7,10,12,16,0,2,4,6,8,10,14,3,7,8,10,6,8,1,2,5,7,0,1,7,2,4,0,1,0,1,5,0,2,0,6,0,
-4.52484847171645e-10,3.15210389538801e-05,-2.14991352047545e-03,5.08058874808345e+02,-1.27123036845932e+07,1.15371133120497e+12,-1.97805728776273e-16,2.41554806033972e-11,-1.56481703640525e-06,2.77211346836625e-03,-2.03578994462286e+01,1.44369489909053e+06,-4.11254217946539e+10,6.23449786243773e-06,-2.21774281146038e+01,-6.89315087933158e+04,-1.95419525060713e+07,3.16373510564015e+03,2.24040754426988e+06,-4.36701347922356e-06,-4.04213852833996e-04,-3.48153203414663e+02,-3.85294213555289e+05,1.35203700099403e-07,1.34648383271089e-04,1.25031835351736e+05,9.68123678455841e-02,2.25660517512438e+02,-1.90102435341872e-04,-2.99628410819229e-02,5.00833915372121e-03,3.87842482998411e-01,-1.38535367777182e+03,8.70745245971773e-01,1.71946252068742,-3.26650121426383e-02,4.98044171727877e+03,5.51478022765087e-03,
};

const double v3e[3][29]={
	-12,-12,-10,-10,-10,-10,-10,-8,-8,-8,-6,-5,-4,-4,-3,-3,-3,-2,-2,-2,-2,-1,0,0,1,1,1,2,2,
14,16,3,6,10,14,16,7,8,10,6,6,2,4,2,6,7,0,1,3,4,0,0,1,0,4,6,0,2,
7.15815808404721e+08,-1.14328360753449e+11,3.76531002015720e-12,-9.03983668691157e-05,6.65695908836252e+05,5.35364174960127e+09,7.94977402335603e+10,9.22230563421437e+01,-1.42586073991215e+05,-1.11796381424162e+06,8.96121629640760e+03,-6.69989239070491e+03,4.51242538486834e-03,-3.39731325977713e+01,-1.20523111552278,4.75992667717124e+04,-2.66627750390341e+05,-1.53314954386524e-04,3.05638404828265e-01,1.23654999499486e+02,-1.04390794213011e+03,-1.57496516174308e-02,6.85331118940253e-01,1.78373462873903,-5.44674124878910e-01,2.04529931318843e+03,-2.28342359328752e+04,4.13197481515899e-01,-3.41931835910405e+01,
};

const double v3f[3][42]={
	0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,4,5,5,6,7,7,10,12,12,12,14,14,14,14,14,16,16,18,18,20,20,20,22,24,24,28,32,
-3,-2,-1,0,1,2,-1,1,2,3,0,1,-5,-2,0,-3,-8,1,-6,-4,1,-6,-10,-8,-4,-12,-10,-8,-6,-4,-10,-8,-12,-10,-12,-10,-6,-12,-12,-4,-12,-12,
-2.51756547792325E-08,6.01307193668763E-06,-1.00615977450049E-03,9.99969140252192E-01,2.14107759236486,-1.65175571959086E+01,-1.41987303638727E-03,2.69251915156554,3.49741815858722E+01,-3.00208695771783E+01,-1.31546288252539,-8.39091277286169,1.81545608337015E-10,-5.91099206478909E-04,1.52115067087106,2.52956470663225E-05,1.00726265203786E-15,-1.49774533860650,-7.93940970562969E-10,-1.50290891264717E-04,1.51205531275133,4.70942606221652E-06,1.95049710391712E-13,-9.11627886266077E-09,6.04374640201265E-04,-2.25132933900136E-16,6.10916973582981E-12,-3.03063908043404E-07,-1.37796070798409E-05,-9.19296736666106E-04,6.39288223132545E-10,7.53259479898699E-07,-4.00321478682929E-13,7.56140294351614E-09,-9.12082054034891E-12,-2.37612381140539E-08,2.69586010591874E-05,-7.32828135157839E-11,2.41995578306660E-10,-4.05735532730322E-04,1.89424143498011E-10,-4.86632965074563E-10,
};

const double v3g[3][38]={
	-12,-12,-12,-12,-12,-12,-10,-10,-10,-8,-8,-8,-8,-6,-6,-5,-5,-4,-3,-2,-2,-2,-2,-1,-1,-1,0,0,0,1,1,1,3,5,6,8,10,10,
7,12,14,18,22,24,14,20,24,7,8,10,12,8,22,7,20,22,7,3,5,14,24,2,8,18,0,1,2,0,1,3,24,22,12,3,0,6,
4.12209020652996E-05,-1.14987238280587E+06,9.48180885032080E+09,-1.95788865718971E+17,4.96250704871300E+24,-1.05549884548496E+28,-7.58642165988278E+11,-9.22172769596101E+22,7.25379072059348E+29,-6.17718249205859E+01,1.07555033344858E+04,-3.79545802336487E+07,2.28646846221831E+11,-4.99741093010619E+06,-2.80214310054101E+30,1.04915406769586E+06,6.13754229168619E+27,8.02056715528378E+31,-2.98617819828065E+07,-9.10782540134681E+01,1.35033227281565E+05,-7.12949383408211E+18,-1.04578785289542E+36,3.04331584444093E+01,5.93250797959445E+09,-3.64174062110798E+27,9.21791403532461E-01,-3.37693609657471E-01,-7.24644143758508E+01,-1.10480239272601E-01,5.36516031875059,-2.91441872156205E+03,6.16338176535305E+39,-1.20889175861180E+38,8.18396024524612E+22,9.40781944835829E+08,-3.67279669545448E+04,-8.37513931798655E+15,
};

const double v3h[3][29]={
	-12,-12,-10,-10,-10,-10,-10,-10,-8,-8,-8,-8,-8,-6,-6,-6,-5,-5,-5,-4,-4,-3,-3,-2,-1,-1,0,1,1,
8,12,4,6,8,10,14,16,0,1,6,7,8,4,6,8,2,3,4,2,4,1,2,0,0,2,0,0,2,
5.61379678887577E-02,7.74135421587083E+09,1.11482975877938E-09,-1.43987128208183E-03,1.93696558764920E+03,-6.05971823585005E+08,1.71951568124337E+13,-1.85461154985145E+16,3.87851168078010E-17,-3.95464327846105E-14,-1.70875935679023E+02,-2.12010620701220E+03,1.77683337348191E+07,1.10177443629575E+01,-2.34396091693313E+05,-6.56174421999594E+06,1.56362212977396E-05,-2.12946257021400,1.35249306374858E+01,1.77189164145813E-01,1.39499167345464E+03,-7.03670932036388E-03,-1.52011044389648E-01,9.81916922991113E-05,1.47199658618076E-03,2.02618487025578E+01,8.99345518944240E-01,-2.11346402240858E-01,2.49971752957491E+01,
};

const double v3i[3][42]={
	0,0,0,1,1,1,1,2,3,3,4,4,4,5,5,5,7,7,8,8,10,12,12,12,14,14,14,14,18,18,18,18,18,20,20,22,24,24,32,32,36,36,
0,1,10,-4,-2,-1,0,0,-5,0,-3,-2,-1,-6,-1,12,-4,-3,-6,10,-8,-12,-6,-4,-10,-8,-4,5,-12,-10,-8,-6,2,-12,-10,-12,-12,-8,-10,-5,-10,-8,
1.06905684359136,-1.48620857922333,2.59862256980408E+14,-4.46352055678749E-12,-5.66620757170032E-07,-2.35302885736849E-03,-2.69226321968839E-01,9.22024992944392,3.57633505503772E-12,-1.73942565562222E+01,7.00681785556229E-06,-2.67050351075768E-04,-2.31779669675624,-7.53533046979752E-13,4.81337131452891,-2.23286270422356E+21,-1.18746004987383E-05,6.46412934136496E-03,-4.10588536330937E-10,4.22739537057241E+19,3.13698180473812E-13,1.64395334345040E-24,-3.39823323754373E-06,-1.35268639905021E-02,-7.23252514211625E-15,1.84386437538366E-09,-4.63959533752385E-02,-9.92263100376750E+13,6.88169154439335E-17,-2.22620998452197E-11,-5.40843018624083E-08,3.45570606200257E-03,4.22275800304086E+10,-1.26974478770487E-15,9.27237985153679E-10,6.12670812016489E-14,-7.22693924063497E-12,-3.83669502636822E-04,3.74684572410204E-04,-9.31976897511086E+04,-2.47690616026922E-02,6.58110546759474E+01,
};

const double v3j[3][29]={
	0,0,0,1,1,1,2,2,3,4,4,5,5,5,6,10,12,12,14,14,14,16,18,20,20,24,24,28,28,
-1,0,1,-2,-1,1,-1,1,-2,-2,2,-3,-2,0,3,-6,-8,-3,-10,-8,-5,-10,-12,-12,-10,-12,-6,-12,-5,
-1.11371317395540E-04,1.00342892423685,5.30615581928979,1.79058760078792E-06,-7.28541958464774E-04,-1.87576133371704E+01,1.99060874071849E-03,2.43574755377290E+01,-1.77040785499444E-04,-2.59680385227130E-03,-1.98704578406823E+02,7.38627790224287E-05,-2.36264692844138E-03,-1.61023121314333,6.22322971786473E+03,-9.60754116701669E-09,-5.10572269720488E-11,7.67373781404211E-03,6.63855469485254E-15,-7.17590735526745E-10,1.46564542926508E-05,3.09029474277013E-12,-4.64216300971708E-16,-3.90499637961161E-14,-2.36716126781431E-10,4.54652854268717E-12,-4.22271787482497E-03,2.83911742354706E-11,2.70929002720228,
};

const double v3k[3][34]={
	-2,-2,-1,-1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,2,2,2,2,2,2,5,5,5,6,6,6,6,8,10,12,
10,12,-5,6,-12,-6,-2,-1,0,1,2,3,14,-3,-2,0,1,2,-8,-6,-3,-2,0,4,-12,-6,-3,-12,-10,-8,-5,-12,-12,-10,
-4.01215699576099E+08,4.84501478318406E+10,3.94721471363678E-15,3.72629967374147E+04,-3.69794374168666E-30,-3.80436407012452E-15,4.75361629970233E-07,-8.79148916140706E-04,8.44317863844331E-01,1.22433162656600E+01,-1.04529634830279E+02,5.89702771277429E+02,-2.91026851164444E+13,1.70343072841850E-06,-2.77617606975748E-04,-3.44709605486686,2.21333862447095E+01,-1.94646110037079E+02,8.08354639772825E-16,-1.80845209145470E-11,-6.96664158132412E-06,-1.81057560300994E-03,2.55830298579027,3.28913873658481E+03,-1.73270241249904E-19,-6.61876792558034E-07,-3.95688923421250E-03,6.04203299819132E-18,-4.00879935920517E-14,1.60751107464958E-09,3.83719409025556E-05,-6.49565446702457E-15,-1.49095328506000E-12,5.41449377329581E-09,
};

const double v3l[3][43]={
	-12,-12,-12,-12,-12,-10,-10,-8,-8,-8,-8,-8,-8,-8,-6,-5,-5,-4,-4,-3,-3,-3,-3,-2,-2,-2,-1,-1,-1,0,0,0,0,1,1,2,4,5,5,6,10,10,14,
14,16,18,20,22,14,24,6,10,12,14,18,24,36,8,4,5,7,16,1,3,18,20,2,3,10,0,1,3,0,1,2,12,0,16,1,0,0,1,14,4,12,10,
2.60702058647537E+09,-1.88277213604704E+14,5.54923870289667E+18,-7.58966946387758E+22,4.13865186848908E+26,-8.15038000738060E+11,-3.81458260489955E+32,-1.23239564600519E-02,2.26095631437174E+07,-4.95017809506720E+11,5.29482996422863E+15,-4.44359478746295E+22,5.21635864527315E+34,-4.87095672740742E+54,-7.14430209937547E+05,1.27868634615495E-01,-1.00752127917598E+01,7.77451437960990E+06,-1.08105480796471E+24,-3.57578581169659E-06,-2.12857169423484,2.70706111085238E+29,-6.95953622348829E+32,1.10609027472280E-01,7.21559163361354E+01,-3.06367307532219E+14,2.65839618885530E-05,2.53392392889754E-02,-2.14443041836579E+02,9.37846601489667E-01,2.23184043101700,3.38401222509191E+01,4.94237237179718E+20,-1.98068404154428E-01,-1.41415349881140E+30,-9.93862421613651E+01,1.25070534142731E+02,-9.96473529004439E+02,4.73137909872765E+04,1.16662121219322E+32,-3.15874976271533E+15,-4.45703369196945E+32,6.42794932373694E+32,
};

const double v3m[3][40]={
	0,3,8,20,1,3,4,5,1,6,2,4,14,2,5,3,0,1,1,1,28,2,16,0,5,0,3,4,12,16,1,8,14,0,2,3,4,8,14,24,
0,0,0,2,5,5,5,5,6,6,7,8,8,10,10,12,14,14,18,20,20,22,22,24,24,28,28,28,28,28,32,32,32,36,36,36,36,36,36,36,
8.11384363481847E-01,-5.68199310990094E+03,-1.78657198172556E+10,7.95537657613427E+31,-8.14568209346872E+04,-6.59774567602874E+07,-1.52861148659302E+10,-5.60165667510446E+11,4.58384828593949E+05,-3.85754000383848E+13,4.53735800004273E+07,9.39454935735563E+11,2.66572856432938E+27,-5.47578313899097E+09,2.00725701112386E+14,1.85007245563239E+12,1.85135446828337E+08,-1.70451090076385E+11,1.57890366037614E+14,-2.02530509748774E+15,3.68193926183570E+59,1.70215539458936E+17,6.39234909918741E+41,-8.21698160721956E+14,-7.95260241872306E+23,2.33415869478510E+17,-6.00079934586803E+22,5.94584382273384E+24,1.89461279349492E+39,-8.10093428842645E+45,1.88813911076809E+21,1.11052244098768E+35,2.91133958602503E+45,-3.29421923951460E+21,-1.37570282536696E+25,1.81508996303902E+27,-3.46865122768353E+29,-2.11961148774260E+37,-1.28617899887675E+48,4.79817895699239E+64,
};

const double v3n[3][39]={
	0,3,4,6,7,10,12,14,18,0,3,5,6,8,12,0,3,7,12,2,3,4,2,4,7,4,3,5,6,0,0,3,1,0,1,0,1,0,1,
-12,-12,-12,-12,-12,-12,-12,-12,-12,-10,-10,-10,-10,-10,-10,-8,-8,-8,-8,-6,-6,-6,-5,-5,-5,-4,-3,-3,-3,-2,-1,-1,0,1,1,2,4,5,6,
2.80967799943151E-39,6.14869006573609E-31,5.82238667048942E-28,3.90628369238462E-23,8.21445758255119E-21,4.02137961842776E-15,6.51718171878301E-13,-2.11773355803058E-08,2.64953354380072E-03,-1.35031446451331E-32,-6.07246643970893E-24,-4.02352115234494E-19,-7.44938506925544E-17,1.89917206526237E-13,3.64975183508473E-06,1.77274872361946E-26,-3.34952758812999E-19,-4.21537726098389E-09,-3.91048167929649E-02,5.41276911564176E-14,7.05412100773699E-12,2.58585887897486E-09,-4.93111362030162E-11,-1.58649699894543E-06,-5.25037427886100E-01,2.20019901729615E-03,-6.43064132636925E-03,6.29154149015048E+01,1.35147318617061E+02,2.40560808321713E-07,-8.90763306701305E-04,-4.40209599407714E+03,-3.02807107747776E+02,1.59158748314599E+03,2.32534272709876E+05,-7.92681207132600E+05,-8.69871364662769E+10,3.54542769185671E+11,4.00849240129329E+14,
};

const double v3o[3][24]={
	0,0,0,2,3,4,4,4,4,4,5,5,6,7,8,8,8,10,10,14,14,20,20,24,
-12,-4,-1,-1,-10,-12,-8,-5,-4,-1,-4,-3,-8,-12,-10,-8,-4,-12,-8,-12,-8,-12,-10,-12,
1.28746023979718E-35,-7.35234770382342E-12,2.89078692149150E-03,2.44482731907223E-01,1.41733492030985E-24,-3.54533853059476E-29,-5.94539202901431E-18,-5.85188401782779E-09,2.01377325411803E-06,1.38647388209306,-1.73959365084772E-05,1.37680878349369E-03,8.14897605805513E-15,4.25596631351839E-26,-3.87449113787755E-18,1.39814747930240E-13,-1.71849638951521E-03,6.41890529513296E-22,1.18960578072018E-11,-1.55282762571611E-18,2.33907907347507E-08,-1.74093247766213E-13,3.77682649089149E-09,-5.16720236575302E-11,
};

const double v3p[3][27]={
	0,0,0,0,1,2,3,3,4,6,7,7,8,10,12,12,12,14,14,14,16,18,20,22,24,24,36,
-1,0,1,2,1,-1,-3,0,-2,-2,-5,-4,-2,-3,-12,-6,-5,-10,-8,-3,-8,-8,-10,-10,-12,-8,-12,
-9.82825342010366E-05,1.05145700850612,1.16033094095084E+02,3.24664750281543E+03,-1.23592348610137E+03,-5.61403450013495E-02,8.56677401640869E-08,2.36313425393924E+02,9.72503292350109E-03,-1.03001994531927,-1.49653706199162E-09,-2.15743778861592E-05,-8.34452198291445,5.86602660564988E-01,3.43480022104968E-26,8.16256095947021E-06,2.94985697916798E-03,7.11730466276584E-17,4.00954763806941E-10,1.07766027032853E+01,-4.09449599138182E-07,-7.29121307758902E-06,6.77107970938909E-09,6.02745973022975E-08,-3.82323011855257E-11,1.79946628317437E-03,-3.45042834640005E-04,
};

const double v3q[3][24]={
	-12,-12,-10,-10,-10,-10,-8,-6,-5,-5,-4,-4,-3,-2,-2,-2,-2,-1,-1,-1,0,1,1,1,
10,12,6,7,8,10,8,6,2,5,3,4,3,0,1,2,4,0,1,2,0,0,1,3,
-8.20433843259950E+04,4.73271518461586E+10,-8.05950021005413E-02,3.28600025435980E+01,-3.56617029982490E+03,-1.72985781433335E+09,3.51769232729192E+07,-7.75489259985144E+05,7.10346691966018E-05,9.93499883820274E+04,-6.42094171904570E-01,-6.12842816820083E+03,2.32808472983776E+02,-1.42808220416837E-05,-6.43596060678456E-03,-4.28577227475614,2.25689939161918E+03,1.00355651721510E-03,3.33491455143516E-01,1.09697576888873,9.61917379376452E-01,-8.38165632204598E-02,2.47795908411492,-3.19114969006533E+03,
};

const double v3r[3][27]={
	-8,-8,-3,-3,-3,-3,-3,0,0,0,0,3,3,8,8,8,8,10,10,10,10,10,10,10,10,12,14,
6,14,-3,3,4,5,8,-1,0,1,5,-6,-2,-12,-10,-8,-5,-12,-10,-8,-6,-5,-4,-3,-2,-12,-12,
1.44165955660863E-03,-7.01438599628258E+12,-8.30946716459219E-17,2.61975135368109E-01,3.93097214706245E+02,-1.04334030654021E+04,4.90112654154211E+08,-1.47104222772069E-04,1.03602748043408,3.05308890065089,-3.99745276971264E+06,5.69233719593750E-12,-4.64923504407778E-02,-5.35400396512906E-18,3.99988795693162E-13,-5.36479560201811E-07,1.59536722411202E-02,2.70303248860217E-15,2.44247453858506E-08,-9.83430636716454E-06,6.63513144224454E-02,-9.93456957845006,5.46491323528491E+02,-1.43365406393758E+04,1.50764974125511E+05,-3.37209709340105E-10,3.77501980025469E-09,
};

const double v3s[3][29]={
	-12,-12,-10,-8,-6,-5,-5,-4,-4,-3,-3,-2,-1,-1,-1,0,0,0,0,1,1,3,3,3,4,4,4,5,14,
20,24,22,14,36,8,16,6,32,3,8,4,1,2,3,0,1,4,28,0,32,0,1,2,3,18,24,4,24,
-5.32466612140254E+22,1.00415480000824E+31,-1.91540001821367E+29,1.05618377808847E+16,2.02281884477061E+58,8.84585472596134E+07,1.66540181638363E+22,-3.13563197669111E+05,-1.85662327545324E+53,-6.24942093918942E-02,-5.04160724132590E+09,1.87514491833092E+04,1.21399979993217E-03,1.88317043049455,-1.67073503962060E+03,9.65961650599775E-01,2.94885696802488,-6.53915627346115E+04,6.04012200163444E+49,-1.98339358557937E-01,-1.75984090163501E+57,3.56314881403987,-5.75991255144384E+02,4.56213415338071E+04,-1.09174044987829E+07,4.37796099975134E+33,-6.16552611135792E+45,1.93568768917797E+09,9.50898170425042E+53,
};

const double v3t[3][33]={
	0,0,0,0,1,1,2,2,2,3,3,4,4,7,7,7,7,7,10,10,10,10,10,18,20,22,22,24,28,32,32,32,36,
0,1,4,12,0,10,0,6,14,3,8,0,10,3,4,7,20,36,10,12,14,16,22,18,32,22,36,24,28,22,32,36,36,
1.55287249586268,6.64235115009031,-2.89366236727210E+03,-3.85923202309848E+12,-2.91002915783761,-8.29088246858083E+11,1.76814899675218,-5.34686695713469E+08,1.60464608687834E+17,1.96435366560186E+05,1.56637427541729E+12,-1.78154560260006,-2.29746237623692E+15,3.85659001648006E+07,1.10554446790543E+09,-6.77073830687349E+13,-3.27910592086523E+30,-3.41552040860644E+50,-5.27251339709047E+20,2.45375640937055E+23,-1.68776617209269E+26,3.58958955867578E+28,-6.56475280339411E+35,3.55286045512301E+38,5.69021454413270E+57,-7.00584546433113E+47,-7.05772623326374E+64,1.66861176200148E+52,-3.00475129680486E+60,-6.68481295196808E+50,4.28432338620678E+68,-4.44227367758304E+71,-2.81396013562745E+76,
};

const double v3u[3][38]={
	-12,-10,-10,-10,-8,-8,-8,-6,-6,-5,-5,-5,-3,-1,-1,-1,-1,0,0,1,2,2,3,5,5,5,6,6,8,8,10,12,12,12,14,14,14,14,
14,10,12,14,10,12,14,8,12,4,8,12,2,-1,1,12,14,-3,1,-2,5,10,-5,-4,2,3,-5,2,-8,8,-4,-12,-4,4,-12,-10,-6,6,
1.22088349258355E+17,1.04216468608488E+09,-8.82666931564652E+15,2.59929510849499E+19,2.22612779142211E+14,-8.78473585050085E+17,-3.14432577551552E+21,-2.16934916996285E+12,1.59079648196849E+20,-3.39567617303423E+02,8.84387651337836E+12,-8.43405926846418E+20,1.14178193518022E+01,-1.22708229235641E-04,-1.06201671767107E+02,9.03443213959313E+24,-6.93996270370852E+27,6.48916718965575E-09,7.18957567127851E+03,1.05581745346187E-03,-6.51903203602581E+14,-1.60116813274676E+24,-5.10254294237837E-09,-1.52355388953402E-01,6.77143292290144E+11,2.76378438378930E+14,1.16862983141686E-02,-3.01426947980171E+13,1.69719813884840E-08,1.04674840020929E+26,-1.08016904560140E+04,-9.90623601934295E-13,5.36116483602738E+06,2.26145963747881E+21,-4.88731565776210E-10,1.51001548880670E-05,-2.27700464643920E+04,-7.81754507698846E+27,
};

const double v3v[3][39]={
	-10,-8,-6,-6,-6,-6,-6,-6,-5,-5,-5,-5,-5,-5,-4,-4,-4,-4,-3,-3,-3,-2,-2,-1,-1,0,0,0,1,1,3,4,4,4,5,8,10,12,14,
-8,-12,-12,-3,5,6,8,10,1,2,6,8,10,14,-12,-10,-6,10,-3,10,12,2,4,-2,0,-2,6,10,-12,-10,3,-6,3,10,2,-12,-2,-3,1,
-4.15652812061591E-55,1.77441742924043E-61,-3.57078668203377E-55,3.59252213604114E-26,-2.59123736380269E+01,5.94619766193460E+04,-6.24184007103158E+10,3.13080299915944E+16,1.05006446192036E-09,-1.92824336984852E-06,6.54144373749937E+05,5.13117462865044E+12,-6.97595750347391E+18,-1.03977184454767E+28,1.19563135540666E-48,-4.36677034051655E-42,9.26990036530639E-30,5.87793105620748E+20,2.80375725094731E-18,-1.92359972440634E+22,7.42705723302738E+26,-5.17429682450605E+01,8.20612048645469E+06,-1.88214882341448E-09,1.84587261114837E-02,-1.35830407782663E-06,-7.23681885626348E+16,-2.23449194054124E+26,-1.11526741826431E-35,2.76032601145151E-29,1.34856491567853E+14,6.52440293345860E-10,5.10655119774360E+16,-4.68138358908732E+31,-7.60667491183279E+15,-4.17247986986821E-19,3.12545677756104E+13,-1.00375333864186E+14,2.47761392329058E+26,
};

const double v3w[3][35]={
	-12,-12,-10,-10,-8,-8,-8,-6,-6,-6,-6,-5,-4,-4,-3,-3,-2,-2,-1,-1,-1,0,0,1,2,2,3,3,5,5,5,8,8,10,10,
8,14,-1,8,6,8,14,-4,-3,2,8,-10,-1,3,-10,3,1,2,-8,-4,1,-12,1,-1,-1,2,-12,-5,-10,-8,-6,-12,-10,-12,-8,
-5.86219133817016E-08,-8.94460355005526E+10,5.31168037519774E-31,1.09892402329239E-01,-5.75368389425212E-02,2.28276853990249E+04,-1.58548609655002E+18,3.29865748576503E-28,-6.34987981190669E-25,6.15762068640611E-09,-9.61109240985747E+07,-4.06274286652625E-45,-4.71103725498077E-13,7.25937724828145E-01,1.87768525763682E-39,-1.03308436323771E+03,-6.62552816342168E-02,5.79514041765710E+02,2.37416732616644E-27,2.71700235739893E-15,-9.07886213483600E+01,-1.71242509570207E-37,1.56792067854621E+02,9.23261357901470E-01,-5.97865988422577,3.21988767636389E+06,-3.99441390042203E-30,4.93429086046981E-08,8.12036983370565E-20,-2.07610284654137E-12,-3.40821291419719E-07,5.42000573372233E-18,-8.56711586510214E-13,2.66170454405981E-14,8.58133791857099E-06,
};

const double v3x[3][36]={
	-8,-6,-5,-4,-4,-4,-3,-3,-1,0,0,0,1,1,2,3,3,3,4,5,5,5,6,8,8,8,8,10,12,12,12,12,14,14,14,14,
14,10,10,1,2,14,-2,12,5,0,4,10,-10,-1,6,-12,0,8,3,-6,-2,1,1,-6,-3,1,8,-8,-10,-8,-5,-4,-12,-10,-8,-6,
3.77373741298151E+18,-5.07100883722913E+12,-1.03363225598860E+15,1.84790814320773E-06,-9.24729378390945E-04,-4.25999562292738E+23,-4.62307771873973E-13,1.07319065855767E+21,6.48662492280682E+10,2.44200600688281,-8.51535733484258E+09,1.69894481433592E+21,2.15780222509020E-27,-3.20850551367334E-01,-3.82642448458610E+16,-2.75386077674421E-29,-5.63199253391666E+05,-3.26068646279314E+20,3.97949001553184E+13,1.00824008584757E-07,1.62234569738433E+04,-4.32355225319745E+10,-5.92874245598610E+11,1.33061647281106,1.57338197797544E+06,2.58189614270853E+13,2.62413209706358E+24,-9.20011937431142E-02,2.20213765905426E-03,-1.10433759109547E+01,8.47004870612087E+06,-5.92910695762536E+08,-1.83027173269660E-05,1.81339603516302E-01,-1.19228759669889E+03,4.30867658061468E+06,
};

const double v3y[3][20]={
	0,0,0,0,1,2,2,2,2,3,3,3,4,4,5,5,8,8,10,12,
-3,1,5,8,8,-4,-1,4,5,-8,4,8,-6,6,-2,1,-8,-2,-5,-8,
-5.25597995024633E-10,5.83441305228407E+03,-1.34778968457925E+16,1.18973500934212E+25,-1.59096490904708E+26,-3.15839902302021E-07,4.96212197158239E+02,3.27777227273171E+18,-5.27114657850696E+21,2.10017506281863E-17,7.05106224399834E+20,-2.66713136106469E+30,-1.45370512554562E-08,1.49333917053130E+27,-1.49795620287641E+07,-3.81881906271100E+15,7.24660165585797E-05,-9.37808169550193E+13,5.14411468376383E+09,-8.28198594040141E+04,
};

const double v3z[3][23]={
	-8,-6,-5,-5,-4,-4,-4,-3,-3,-3,-2,-1,0,1,2,3,3,6,6,6,6,8,8,
3,6,6,8,5,6,8,-2,5,6,2,-6,3,1,6,-6,-2,-6,-5,-4,-1,-8,-4,
2.4400789229065E-11,-4.6305743033124E+06,7.2880327477771E+09,3.2777630285886E+15,-1.1059817011841E+09,-3.2389991572996E+12,9.2381400702325E+15,8.4225008041371E-13,6.6322143624551E+11,-1.6717018667214E+14,2.5374935870139E+03,-8.1973155961052E-21,3.2838058789066E+11,-6.2500479117154E+07,8.0319795746202E+20,-2.0439701133835E-11,-3.7839104705594E+03,9.7287654593862E-03,1.5435572168146E+01,-3.7396286292864E+03,-6.8285901137457E+10,-2.4848801561454E-04,3.9453604949707E+06,
};

const double subregion_coeff[26][9]={
	0.0024,100e6,760,30,0.085,0.817,1,1,1,
	0.0041,100e6,860,32,0.280,0.779,1,1,1,
	0.0022,40e6,690,35,0.259,0.903,1,1,1,
	0.0029,40e6,690,38,0.559,0.939,1,1,4,
	0.0032,40e6,710,29,0.587,0.918,1,1,1,
	0.0064,40e6,730,42,0.587,0.891,0.5,1,4,
	0.0027,25e6,660,38,0.872,0.971,1,1,4,
	0.0032,25e6,660,29,0.898,0.983,1,1,4,
	0.0041,25e6,660,42,0.910,0.984,0.5,1,4,
	0.0054,25e6,670,29,0.875,0.964,0.5,1,4,
	0.0077,25e6,680,34,0.802,0.935,1,1,1,
	0.0026,24e6,650,43,0.908,0.989,1,1,4,
	0.0028,23e6,650,40,1.00,0.997,1,0.25,1,
	0.0031,23e6,650,39,0.976,0.997,-1,-1,-1,
	0.0034,23e6,650,24,0.974,0.996,0.5,1,1,
	0.0041,23e6,650,27,0.972,0.997,0.5,1,1,
	0.0022,23e6,650,24,0.848,0.983,1,1,4,
	0.0054,23e6,650,27,0.874,0.982,1,1,1,
	0.0022,21e6,640,29,0.886,0.990,1,1,4,
	0.0088,20e6,650,33,0.803,1.02,1,1,1,
	0.0026,23e6,650,38,0.902,0.988,1,1,1,
	0.0031,23e6,650,39,0.960,0.995,1,1,1,
	0.0039,23e6,650,35,0.959,0.995,1,1,4,
	0.0049,23e6,650,36,0.910,0.988,1,1,1,
	0.0031,22e6,650,20,0.996,0.994,1,1,4,
	0.0038,22e6,650,23,0.993,0.994,1,1,4,	
};

//const double subregion_coeff_ 

double t3abp(double pres)
{
	double ii,ni,pi,res;
	int i;
	res=0;
	pi=pres/1e6;
	for(i=0;i<5;i++)
	{
		ni=t3ab[i][1];
		ii=t3ab[i][0];
		res+=ni*pow(log(pi),ii);
	}
	return res;
}

double t3cdp(double pres)
{
	double ii,ni,pi,res;
	int i;
	res=0;
	pi=pres/1e6;
	for(i=0;i<4;i++)
	{
		ni=t3cd[i][1];
		ii=t3cd[i][0];
		res+=ni*pow(pi,ii);
	}
	return res;
}

double t3efp(double pres)
{
	double pi;
	pi=pres/1e6;
	return 3.727888004*(pi-22.064)+647.096;
}

double t3ghp(double pres)
{
	double ii,ni,pi,res;
	int i;
	res=0;
	pi=pres/1e6;
	for(i=0;i<5;i++)
	{
		ni=t3gh[i][1];
		ii=t3gh[i][0];
		res+=ni*pow(pi,ii);
	}
	return res;
}

double t3ijp(double pres)
{
	double ii,ni,pi,res;
	int i;
	res=0;
	pi=pres/1e6;
	for(i=0;i<5;i++)
	{
		ni=t3ij[i][1];
		ii=t3ij[i][0];
		res+=ni*pow(pi,ii);
	}
	return res;
}

double t3jkp(double pres)
{
	double ii,ni,pi,res;
	int i;
	res=0;
	pi=pres/1e6;
	for(i=0;i<5;i++)
	{
		ni=t3jk[i][1];
		ii=t3jk[i][0];
		res+=ni*pow(pi,ii);
	}
	return res;
}

double t3mnp(double pres)
{
	double ii,ni,pi,res;
	int i;
	res=0;
	pi=pres/1e6;
	for(i=0;i<4;i++)
	{
		ni=t3mn[i][1];
		ii=t3mn[i][0];
		res+=ni*pow(pi,ii);
	}
	return res;
}

double t3opp(double pres)
{
	double ii,ni,pi,res;
	int i;
	res=0;
	pi=pres/1e6;
	for(i=0;i<5;i++)
	{
		ni=t3op[i][1];
		ii=t3op[i][0];
		res+=ni*pow(log(pi),ii);
	}
	return res;
}

double t3qup(double pres)
{
	double ii,ni,pi,res;
	int i;
	res=0;
	pi=pres/1e6;
	for(i=0;i<4;i++)
	{
		ni=t3qu[i][1];
		ii=t3qu[i][0];
		res+=ni*pow(pi,ii);
	}
	return res;	
}

double t3rxp(double pres)
{
	double ii,ni,pi,res;
	int i;
	res=0;
	pi=pres/1e6;
	for(i=0;i<4;i++)
	{
		ni=t3rx[i][1];
		ii=t3rx[i][0];
		res+=ni*pow(pi,ii);
	}
	return res;
}
double tsatp(double pres)
{
	double D,E,F,G,beta;
	double n10,n9;
	beta=pow(pres/1e6,0.25);
	E=beta*beta+sat_coeff_r3[2]*beta+sat_coeff_r3[5];
	F=sat_coeff_r3[0]*beta*beta+sat_coeff_r3[3]*beta+sat_coeff_r3[6];
	G=sat_coeff_r3[1]*beta*beta+sat_coeff_r3[4]*beta+sat_coeff_r3[7];
	D=2*G/(-F-sqrt(F*F-4*E*G));
	n10=sat_coeff_r3[9];
	n9=sat_coeff_r3[8];
	return 0.5*(n10+D-sqrt((n10+D)*(n10+D)-4*(n9+n10*D)));
}

double psatt(double temp)
{
	double A,B,C,delt,n9,n10;
	n9=sat_coeff_r3[8];
	n10=sat_coeff_r3[9];
		
	delt=temp+n9/(temp-n10);
	A=delt*delt+sat_coeff_r3[0]*delt+sat_coeff_r3[1];
	B=sat_coeff_r3[2]*delt*delt+sat_coeff_r3[3]*delt+sat_coeff_r3[4];
	C=sat_coeff_r3[5]*delt*delt+sat_coeff_r3[6]*delt+sat_coeff_r3[7];
	return 1e6*pow(2*C/(-B+sqrt(B*B-4*A*C)),4);
}

double t3uvp(double pres)
{
	double ii,ni,pi,res;
	int i;
	res=0;
	pi=pres/1e6;
	for(i=0;i<4;i++)
	{
		ni=t3uv[i][1];
		ii=t3uv[i][0];
		res+=ni*pow(pi,ii);
	}
	return res;
}

double t3wxp(double pres)
{
	double ii,ni,pi,res;
	int i;
	res=0;
	pi=pres/1e6;
	for(i=0;i<5;i++)
	{
		ni=t3wx[i][1];
		ii=t3wx[i][0];
		res+=ni*pow(log(pi),ii);
	}
	return res;
}

int pt_subregion_calc1(double pres, double temp)
{
	double t3abb,t3cdb,t3efb,t3ghb,t3ijb,t3jkb,t3mnb,t3opb,t3qub,t3rxb;
	double p3cd,psat643,tsatb;
	
	p3cd=19.00881189173929e6;
	psat643=21.04336732e6;
	if(pres>40e6)
	{
		t3abb=t3abp(pres);
		if(temp-t3abb<ZERO)
		return 1;//3a
		else
		return 2;//3b
	}
	else if(pres>25e6)
	{
		t3abb=t3abp(pres);
		t3cdb=t3cdp(pres);
		t3efb=t3efp(pres);
		
		if(temp-t3cdb<ZERO)
		return 3;//3c
		else if(temp-t3abb<ZERO)
		return 4;//3d
		else if(temp-t3efb<ZERO)
		return 5;//3e
		else
		return 6;//3f
	}
	else if(pres>23.5e6)
	{
		t3cdb=t3cdp(pres);
		t3efb=t3efp(pres);
		t3ghb=t3ghp(pres);
		t3ijb=t3ijp(pres);
		t3jkb=t3jkp(pres);
		
		if(temp-t3cdb<ZERO)
		return 3;//3c
		else if(temp-t3ghb<ZERO)
		return 7;//3g
		else if(temp-t3efb<ZERO)
		return 8;//3h
		else if(temp-t3ijb<ZERO)
		return 9;//3i
		else if(temp-t3jkb<ZERO)
		return 10;//3j;
		else
		return 11;//3k
	}
	else if(pres>23e6)
	{
		t3cdb=t3cdp(pres);
		t3efb=t3efp(pres);
		t3ghb=t3ghp(pres);
		t3ijb=t3ijp(pres);
		t3jkb=t3jkp(pres);
		
		if(temp-t3cdb<ZERO)
		return 3;//3c
		else if(temp-t3ghb<ZERO)
		return 12;//3l
		else if(temp-t3efb<ZERO)
		return 8;//3h
		else if(temp-t3ijb<ZERO)
		return 9;//3i
		else if(temp-t3jkb<ZERO)
		return 10;//3j;
		else 
		return 11;//3k
	}
	else if(pres>22.5e6)
	{
		t3cdb=t3cdp(pres);
		t3efb=t3efp(pres);
		t3ghb=t3ghp(pres);
		t3ijb=t3ijp(pres);
		t3jkb=t3jkp(pres);
		t3mnb=t3mnp(pres);
		t3opb=t3opp(pres);
		if(temp-t3cdb<ZERO)
		return 3;//3c
		else if(temp-t3ghb<ZERO)
		return 12;//3l
		else if(temp-t3mnb<ZERO)
		return 13;//3m
		else if(temp-t3efb<ZERO)
		return 14;//3n
		else if(temp-t3opb<ZERO)
		return 15;//3o
		else if(temp-t3ijb<ZERO)
		return 16;//3p
		else if(temp-t3jkb<ZERO)
		return 10;//3j
		else
		return 11;	//3k			
	}
	else if(pres>psat643)
	{
		t3cdb=t3cdp(pres);
		t3qub=t3qup(pres);
		t3rxb=t3rxp(pres);
		t3jkb=t3jkp(pres);
//		printf("%lf\n",t3qub);
		
		if(temp-t3cdb<ZERO)
		return 3;//3c
		else if(temp-t3qub<ZERO)
		return 17;//3q
		else if(temp>t3rxb&&(temp-t3jkb<ZERO))
		return 18;//3r
		else if(temp>t3jkb)
		return 11;//3k
	}
	
	else if(pres>20.5e6)
	{
		t3cdb=t3cdp(pres);
		tsatb=tsatp(pres);
		t3jkb=t3jkp(pres);
		
		if(temp-t3cdb<ZERO)
		return 3;//3c
		else if(temp-tsatb<ZERO)
		return 19;//3s
		else if(temp-t3jkb<ZERO)
		return 18;//3r
		else
		return 11;//3k
	}
	
	else if(pres>p3cd)
	{
		t3cdb=t3cdp(pres);
		tsatb=tsatp(pres);
		
		if(temp-t3cdb<ZERO)
		return 3;//3c
		else if(temp-tsatb<ZERO)
		return 19;//3s
		else 
		return 20;//3t
	}
	else if(pres>psatt(623.15))
	{
		tsatb=tsatp(pres);
		if(temp-tsatb<ZERO)
		return 3;//3c
		else
		return 20;//3t
	}
	return -1;
}

int pt_subregion_calc2(double pres, double temp)
{
	double t3qub,t3uvb,t3efb,t3wxb,t3rxb;
	double psat264,psat385,psat643;
	psat643=21.04336732e6;
	psat264=21.93161551e6;
	psat385=21.90096265e6;
	
	if(pres>22.11e6&&(pres-22.5e6<ZERO))
	{
		t3qub=t3qup(pres);
		t3uvb=t3uvp(pres);
		t3efb=t3efp(pres);
		t3wxb=t3wxp(pres);
		t3rxb=t3rxp(pres);
		if(temp>t3qub&&(temp-t3uvb<ZERO))
		return 21;//3u
		else if(temp-t3efb<ZERO)
		return 22;//3v
		else if(temp-t3wxb<ZERO)
		return 23;//3w
		else if(temp-t3rxb<ZERO)
		return 24;//3x 
	}
	
	else if(pres>22.064e6&&(pres-22.11e6<ZERO))
	{
		t3qub=t3qup(pres);
		t3uvb=t3uvp(pres);
		t3efb=t3efp(pres);
		t3wxb=t3wxp(pres);
		t3rxb=t3rxp(pres);
		if(temp>t3qub&&(temp-t3uvb<ZERO))
		return 21;//3u
		else if(temp-t3efb<ZERO)
		return 25;//3y
		else if(temp-t3wxb<ZERO)
		return 26;//3z
		else if(temp-t3rxb<ZERO)
		return 24;//3x
	}
	
	if(temp-tsatp(pres)<ZERO)
	{
		if(pres>psat264&&(pres-22.064e6<ZERO))
		{
			t3qub=t3qup(pres);
			t3uvb=t3uvp(pres);
//			printf("%.8lf\n%.8lf\n",temp,t3uvb);
			if(temp>t3qub&&(temp-t3uvb<ZERO))
			return 21;//3u
			else{
//				printf("!!!!!!!!!!!!!!!!!!!!!\n");
				return 25;//3y
			}
			
		}
		else if(pres>psat643)
		{
			t3qub=t3qup(pres);
			if(temp>t3qub)
			return 21;//3u
		}	
	}
	else if(temp>tsatp(pres))
	{
		if(pres>psat385&&(pres-22.064e6)<ZERO)
		{
			t3wxb=t3wxp(pres);
			t3rxb=t3rxp(pres);
			if(temp-t3wxb<ZERO)
			return 26;//3u
			else if(temp-t3rxb<ZERO)
			return 25;//3y
		}
		else if(pres>psat643)
		{
			t3rxb=t3rxp(pres);
			if(temp-t3rxb<ZERO)
			return 24;//3x
		}	
	}
	
	return -1;	
}

double calc_vpt(int sr, double pres, double temp)
{
	double v,vsum,pi,theta,ni,ii,ji;
	double v0,p0,t0,a,b,c,d,e;
	int i,N;

	v0=subregion_coeff[sr-1][0];
	p0=subregion_coeff[sr-1][1];
	t0=subregion_coeff[sr-1][2];
	N=(int)subregion_coeff[sr-1][3];
	a=subregion_coeff[sr-1][4];
	b=subregion_coeff[sr-1][5];
	c=subregion_coeff[sr-1][6];
	d=subregion_coeff[sr-1][7];
	e=subregion_coeff[sr-1][8];
	
//	printf("%lf\n%lf\n%lf\n%d\n%lf\n%lf\n%lf\n%lf\n%lf\n",v0,p0,t0,N,a,b,c,d,e);
	
	vsum=0;
	pi=pres/p0;
	theta=temp/t0;
//	printf("!!%lf\t%lf\n",pi,theta);
		
	if(sr==14)
	{
		for(i=0;i<N;i++)
		{
			ni=v3n[2][i];
			ii=v3n[0][i];
			ji=v3n[1][i];
			vsum+=ni*pow(pi-a,ii)*pow(theta-b,ji);
		}
		v=v0*exp(vsum);
		return v;
	}
	else
	{
		for(i=0;i<N;i++)
		{
			if(sr==1)
			{
				ni=v3a[2][i];
				ii=v3a[0][i];
				ji=v3a[1][i];
			}
			
			else if(sr==2)
			{
				ni=v3b[2][i];
				ii=v3b[0][i];
				ji=v3b[1][i];
			}
			
			else if(sr==3)
			{
				ni=v3c[2][i];
				ii=v3c[0][i];
				ji=v3c[1][i];
			}
			
			else if(sr==4)
			{
				ni=v3d[2][i];
				ii=v3d[0][i];
				ji=v3d[1][i];
			}
			
			else if(sr==5)
			{
				ni=v3e[2][i];
				ii=v3e[0][i];
				ji=v3e[1][i];
			}
			
			else if(sr==6)
			{
				ni=v3f[2][i];
				ii=v3f[0][i];
				ji=v3f[1][i];
			}
			
			else if(sr==7)
			{
				ni=v3g[2][i];
				ii=v3g[0][i];
				ji=v3g[1][i];
			}
			
			else if(sr==8)
			{
				ni=v3h[2][i];
				ii=v3h[0][i];
				ji=v3h[1][i];
			}
			
			else if(sr==9)
			{
				ni=v3i[2][i];
				ii=v3i[0][i];
				ji=v3i[1][i];
			}
			
			else if(sr==10)
			{
				ni=v3j[2][i];
				ii=v3j[0][i];
				ji=v3j[1][i];
			}
			
			else if(sr==11)
			{
				ni=v3k[2][i];
				ii=v3k[0][i];
				ji=v3k[1][i];
			}
			
			else if(sr==12)
			{
				ni=v3l[2][i];
				ii=v3l[0][i];
				ji=v3l[1][i];
			}
			
			else if(sr==13)
			{
				ni=v3m[2][i];
				ii=v3m[0][i];
				ji=v3m[1][i];
			}
			
			else if(sr==15)
			{
				ni=v3o[2][i];
				ii=v3o[0][i];
				ji=v3o[1][i];
			}
			
			else if(sr==16)
			{
				ni=v3p[2][i];
				ii=v3p[0][i];
				ji=v3p[1][i];
			}
			
			else if(sr==17)
			{
				ni=v3q[2][i];
				ii=v3q[0][i];
				ji=v3q[1][i];
			}
			
			else if(sr==18)
			{
				ni=v3r[2][i];
				ii=v3r[0][i];
				ji=v3r[1][i];
			}
			
			else if(sr==19)
			{
				ni=v3s[2][i];
				ii=v3s[0][i];
				ji=v3s[1][i];
			}
			
			else if(sr==20)
			{
				ni=v3t[2][i];
				ii=v3t[0][i];
				ji=v3t[1][i];
			}
			else if(sr==21)
			{
				ni=v3u[2][i];
				ii=v3u[0][i];
				ji=v3u[1][i];
			}
			else if(sr==22)
			{
				ni=v3v[2][i];
				ii=v3v[0][i];
				ji=v3v[1][i];
			}
			else if(sr==23)
			{
				ni=v3w[2][i];
				ii=v3w[0][i];
				ji=v3w[1][i];
			}
			else if(sr==24)
			{
				ni=v3x[2][i];
				ii=v3x[0][i];
				ji=v3x[1][i];
			}
			else if(sr==25)
			{
				ni=v3y[2][i];
				ii=v3y[0][i];
				ji=v3y[1][i];
			}
			else if(sr==26)
			{
				ni=v3z[2][i];
				ii=v3z[0][i];
				ji=v3z[1][i];
			}
//			printf("!!!%d,%.0lf,%.0lf,%.12lf\n",i,ii,ji,ni);			
			vsum+=ni*pow(pow(pi-a,c),ii)*pow(pow(theta-b,d),ji);
		}
		v=v0*pow(vsum,e);
		return v;
	}
}

double spe_vol_pt(double pres, double temp)
{
	int sr;
	sr=pt_subregion_calc1(pres,temp);
	if(sr==-1)
	{
		sr=pt_subregion_calc2(pres,temp);
		if(sr==-1)
		{
			return -0.1;
		}
	}
	return calc_vpt(sr,pres,temp);
}


double phi(double delta, double tau)
{
	int i;
	double ni,ii,ji,res;
	res=region3_coeff[0][3]*log(delta);
	for(i=1;i<40;i++)
	{
		ni=region3_coeff[i][3];
		ii=region3_coeff[i][1];
		ji=region3_coeff[i][2];
		res+=ni*pow(delta,ii)*pow(tau,ji);
	}
	return res;
}

double phid(double delta, double tau)
{
	int i;
	double ni,ii,ji,res;
	res=region3_coeff[0][3]/delta;
	for(i=1;i<40;i++)
	{
		ni=region3_coeff[i][3];
		ii=region3_coeff[i][1];
		ji=region3_coeff[i][2];
		res+=ni*ii*pow(delta,ii-1)*pow(tau,ji);
	}
	return res;
}

double phidd(double delta, double tau)
{
	int i;
	double ni,ii,ji,res;
	res=-region3_coeff[0][3]/(delta*delta);
	for(i=1;i<40;i++)
	{
		ni=region3_coeff[i][3];
		ii=region3_coeff[i][1];
		ji=region3_coeff[i][2];
		res+=ni*ii*(ii-1)*pow(delta,ii-2)*pow(tau,ji);
	}
	return res;
}

double phit(double delta, double tau)
{
	int i;
	double ni,ii,ji,res;
	res=0;
	for(i=1;i<40;i++)
	{
		ni=region3_coeff[i][3];
		ii=region3_coeff[i][1];
		ji=region3_coeff[i][2];
		res+=ni*pow(delta,ii)*ji*pow(tau,ji-1);
	}
	return res;
}

double phitt(double delta, double tau)
{
	int i;
	double ni,ii,ji,res;
	res=0;
	for(i=1;i<40;i++)
	{
		ni=region3_coeff[i][3];
		ii=region3_coeff[i][1];
		ji=region3_coeff[i][2];
		res+=ni*pow(delta,ii)*ji*(ji-1)*pow(tau,ji-2);
	}
	return res;
}

double phidt(double delta, double tau)
{
	int i;
	double ni,ii,ji,res;
	res=0;
	for(i=1;i<40;i++)
	{
		ni=region3_coeff[i][3];
		ii=region3_coeff[i][1];
		ji=region3_coeff[i][2];
		res+=ni*ii*pow(delta,ii-1)*ji*pow(tau,ji-1);
	}
	return res;
}

void r3prop_calc_tr(double temp, double dens, steam_prop* p_prop)
{
	double tau=T_C/temp;
	double del=dens/r_c;
	
	p_prop->pressure=dens*GAS_CONST_STEAM*temp*del*phid(del,tau);
	p_prop->temp=temp;
	p_prop->dens=dens;
	p_prop->spe_vol=1/dens;
	p_prop->spe_energy=tau*phit(del,tau)*GAS_CONST_STEAM*temp;
	p_prop->spe_entr=(tau*phit(del,tau)-phi(del,tau))*GAS_CONST_STEAM;
	p_prop->spe_enth=(tau*phit(del,tau)+del*phid(del,tau))*GAS_CONST_STEAM*temp;
	p_prop->spe_h_v=-tau*tau*phitt(del,tau)*GAS_CONST_STEAM;
	p_prop->spe_h_p=(-tau*tau*phitt(del,tau)+pow(del*phid(del,tau)-del*tau*phidt(del,tau),2)/(2*del*phid(del,tau)+del*del*phidd(del,tau)))*GAS_CONST_STEAM;
	p_prop->speed_sound=sqrt(GAS_CONST_STEAM*temp*(2*del*phid(del,tau)+del*del*phidd(del,tau)-pow(del*phid(del,tau)-del*tau*phidt(del,tau),2)/(tau*tau*phitt(del,tau))));
	p_prop->drdp=1/(GAS_CONST_STEAM*temp*(phidd(del,tau)*del*del+2*del*phid(del,tau)));
	p_prop->vapor_fraction=1;
}


void calcFD_dFD_pt(double* fd, double* dfd, double pres, double temp, double del)
{
	double tau=T_C/temp;
	*fd=r_c*del*del*phid(del,tau)-pres/(GAS_CONST_STEAM*temp);
	*dfd=r_c*(2*del*phid(del,tau)+del*del*phidd(del,tau));
}

int hp_dens_pt(double* dens_final, double dens_ini, double pres, double temp)
{
	double fd,dfd,del_prev,del_next;
	int i=0;
	del_prev=dens_ini/r_c;
	do
	{
		calcFD_dFD_pt(&fd,&dfd,pres,temp,del_prev);
		del_next=del_prev-fd/dfd;
		if(fabs(del_next-del_prev)<ZERO)
			break;
		else
			del_prev=del_next;
		i++;
	}while(i<MAX_ITER_TIMES);
	if(i==MAX_ITER_TIMES)
		return -1;
	else
		*dens_final=del_next*r_c;
	return 0;
}

void calcFT_dFT_prr3(double* ft, double* dft, double pres, double dens, double tau)
{
	double del=dens/r_c;
	*ft=r_c*del*del*phid(del,tau)-pres*tau/(GAS_CONST_STEAM*T_C);
	*dft=r_c*del*del*phidt(del,tau)-pres/(GAS_CONST_STEAM*T_C);
}

int temp_pr_r3(double* temp, double pres, double dens)
{
	double ft,dft,tau_prev,tau_nxt;
	int iter_times=0;
	double tau_ini=1;
	calcFT_dFT_prr3(&ft,&dft,pres,dens,tau_ini);
	tau_nxt=tau_ini-ft/dft;
	do{
		tau_prev=tau_nxt;
		calcFT_dFT_prr3(&ft,&dft,pres,dens,tau_prev);
		tau_nxt=tau_prev-ft/dft;
		iter_times++;
	}while(fabs(tau_nxt-tau_prev)>ZERO&&iter_times<MAX_ITER_TIMES);
	if(iter_times==MAX_ITER_TIMES)
	{
//		printf("\n\nlllllllllllllllll\n");
		*temp=-1;
		return -1;
	}
	else
	{
//		printf("\n\n%lf\n",tau_nxt);
		*temp=T_C/tau_nxt;
//		printf("\n\n%lf\n",*temp);
		return 0;
	}	
}

void calcFG_DFG_ph(double* f, double* g, double* dfdd, double* dgdd, double* dfdt, double* dgdt, double pres, double spe_enth, double del, double tau)
{
	*f=r_c*del*del*phid(del,tau)-pres*tau/(GAS_CONST_STEAM*T_C);
	*g=tau*phit(del,tau)+del*phid(del,tau)-spe_enth*tau/(GAS_CONST_STEAM*T_C);
	*dfdd=r_c*(del*del*phidd(del,tau)+2*del*phid(del,tau));
	*dfdt=r_c*del*del*phidt(del,tau)-pres/(GAS_CONST_STEAM*T_C);
	*dgdd=tau*phidt(del,tau)+phid(del,tau)+del*phidd(del,tau);
	*dgdt=phit(del,tau)+tau*phitt(del,tau)+del*phidt(del,tau)-spe_enth/(GAS_CONST_STEAM*T_C);
}

int tr_ph_r3(double* temp, double* dens, double pres, double spe_enth)
{
	double ff,gg,dfdd,dfdt,dgdd,dgdt,tau_prev,tau_nxt,del_prev,del_nxt;
	double tau_ini=1;
	double del_ini=1;
	double dd,dt,dmax;	
	int i=0;
	
	calcFG_DFG_ph(&ff,&gg,&dfdd,&dgdd,&dfdt,&dgdt,pres,spe_enth,del_ini,tau_ini);
	if(fabs(dfdd*dgdt-dgdd*dfdt)<ZERO)
		return -1;
	dt=(gg*dfdd-ff*dgdd)/(dgdd*dfdt-dfdd*dgdt);
	dd=(gg*dfdt-ff*dgdt)/(dgdt*dfdd-dgdd*dfdt);
	tau_nxt=tau_ini+dt;
	del_nxt=del_ini+dd; 
	do
	{
		tau_prev=tau_nxt;
		del_prev=del_nxt;
		calcFG_DFG_ph(&ff,&gg,&dfdd,&dgdd,&dfdt,&dgdt,pres,spe_enth,del_nxt,tau_nxt);
		if(fabs(dfdd*dgdt-dgdd*dfdt)<ZERO)
		return -1;
		dt=(gg*dfdd-ff*dgdd)/(dgdd*dfdt-dfdd*dgdt);
		dd=(gg*dfdt-ff*dgdt)/(dgdt*dfdd-dgdd*dfdt);
		tau_nxt=tau_prev+dt;
		del_nxt=del_prev+dd; 
		i++;
		if(fabs(dt)>fabs(dd))
			dmax=fabs(dt);
		else
			dmax=fabs(dd);
	}while(dmax>ZERO&&i<MAX_ITER_TIMES);
	if(i==MAX_ITER_TIMES)
	{
		*temp=-1;
		*dens=-1;
		return -1;
	}
	else
	{
//		printf("%lf\n",next_temp);
		*temp=T_C/tau_nxt;
		*dens=r_c*del_nxt;
		return 0;
	}
}

void calcFG_DFG_ps(double* f, double* g, double* dfdd, double* dgdd, double* dfdt, double* dgdt, double pres, double spe_entr, double del, double tau)
{
	*f=r_c*del*del*phid(del,tau)-pres*tau/(GAS_CONST_STEAM*T_C);
	*g=tau*phit(del,tau)-phi(del,tau)-spe_entr/GAS_CONST_STEAM;
	*dfdd=r_c*(2*del*phid(del,tau)+del*del*phidd(del,tau));
	*dfdt=r_c*del*del*phidt(del,tau)-pres/(GAS_CONST_STEAM*T_C);
	*dgdd=tau*phidt(del,tau)-phid(del,tau);
	*dgdt=tau*phitt(del,tau);
}

int tr_ps_r3(double* temp, double* dens, double pres, double spe_entr)
{
	double ff,gg,dfdd,dfdt,dgdd,dgdt,tau_prev,tau_nxt,del_prev,del_nxt;
	double tau_ini=1;
	double del_ini=1;
	double dd,dt,dmax;	
	int i=0;
	
	calcFG_DFG_ps(&ff,&gg,&dfdd,&dgdd,&dfdt,&dgdt,pres,spe_entr,del_ini,tau_ini);
	if(fabs(dfdd*dgdt-dgdd*dfdt)<ZERO)
		return -1;
	dt=(gg*dfdd-ff*dgdd)/(dgdd*dfdt-dfdd*dgdt);
	dd=(gg*dfdt-ff*dgdt)/(dgdt*dfdd-dgdd*dfdt);
	tau_nxt=tau_ini+dt;
	del_nxt=del_ini+dd; 
	do
	{
		tau_prev=tau_nxt;
		del_prev=del_nxt;
		calcFG_DFG_ps(&ff,&gg,&dfdd,&dgdd,&dfdt,&dgdt,pres,spe_entr,del_nxt,tau_nxt);
		if(fabs(dfdd*dgdt-dgdd*dfdt)<ZERO)
		return -1;
		dt=(gg*dfdd-ff*dgdd)/(dgdd*dfdt-dfdd*dgdt);
		dd=(gg*dfdt-ff*dgdt)/(dgdt*dfdd-dgdd*dfdt);
		tau_nxt=tau_prev+dt;
		del_nxt=del_prev+dd; 
		i++;
		if(fabs(dt)>fabs(dd))
			dmax=fabs(dt);
		else
			dmax=fabs(dd);
	}while(dmax>ZERO&&i<MAX_ITER_TIMES);
	if(i==MAX_ITER_TIMES)
	{
		*temp=-1;
		*dens=-1;
		return -1;
	}
	else
	{
//		printf("%lf\n",next_temp);
		*temp=T_C/tau_nxt;
		*dens=r_c*del_nxt;
		return 0;
	}
}

void calcFG_DFG_pu(double* f, double* g, double* dfdd, double* dgdd, double* dfdt, double* dgdt, double pres, double spe_ener, double del, double tau)
{
	*f=r_c*del*del*phid(del,tau)-pres*tau/(GAS_CONST_STEAM*T_C);
	*g=tau*phit(del,tau)-spe_ener*tau/(GAS_CONST_STEAM*T_C);
	*dfdd=r_c*(2*del*phid(del,tau)+del*del*phidd(del,tau));
	*dfdt=r_c*del*del*phidt(del,tau)-pres/(GAS_CONST_STEAM*T_C);
	*dgdd=tau*phidt(del,tau);
	*dgdt=tau*phitt(del,tau)+phit(del,tau)-spe_ener/(GAS_CONST_STEAM*T_C);
}

int tr_pu_r3(double* temp, double* dens, double pres, double spe_ener)
{
	double ff,gg,dfdd,dfdt,dgdd,dgdt,tau_prev,tau_nxt,del_prev,del_nxt;
	double tau_ini=1;
	double del_ini=1;
	double dd,dt,dmax;	
	int i=0;
	
	calcFG_DFG_pu(&ff,&gg,&dfdd,&dgdd,&dfdt,&dgdt,pres,spe_ener,del_ini,tau_ini);
	if(fabs(dfdd*dgdt-dgdd*dfdt)<ZERO)
		return -1;
	dt=(gg*dfdd-ff*dgdd)/(dgdd*dfdt-dfdd*dgdt);
	dd=(gg*dfdt-ff*dgdt)/(dgdt*dfdd-dgdd*dfdt);
	tau_nxt=tau_ini+dt;
	del_nxt=del_ini+dd; 
	do
	{
		tau_prev=tau_nxt;
		del_prev=del_nxt;
		calcFG_DFG_pu(&ff,&gg,&dfdd,&dgdd,&dfdt,&dgdt,pres,spe_ener,del_prev,tau_prev);
		if(fabs(dfdd*dgdt-dgdd*dfdt)<ZERO)
		return -1;
		dt=(gg*dfdd-ff*dgdd)/(dgdd*dfdt-dfdd*dgdt);
		dd=(gg*dfdt-ff*dgdt)/(dgdt*dfdd-dgdd*dfdt);
		tau_nxt=tau_prev+dt;
		del_nxt=del_prev+dd; 
		i++;
		if(fabs(dt)>fabs(dd))
			dmax=fabs(dt);
		else
			dmax=fabs(dd);
	}while(dmax>ZERO&&i<MAX_ITER_TIMES);
	if(i==MAX_ITER_TIMES)
	{
		*temp=-1;
		*dens=-1;
		return -1;
	}
	else
	{
//		printf("%lf\n",next_temp);
		*temp=T_C/tau_nxt;
		*dens=r_c*del_nxt;
		return 0;
	}
}

void calcFG_DFG_hs(double* f, double* g, double* dfdd, double* dgdd, double* dfdt, double* dgdt, double spe_enth, double spe_entr, double del, double tau)
{
	*f=tau*phit(del,tau)+del*phid(del,tau)-spe_enth*tau/(GAS_CONST_STEAM*T_C);
	*g=tau*phit(del,tau)-phi(del,tau)-spe_entr/GAS_CONST_STEAM;
	*dfdd=tau*phidt(del,tau)+del*phidd(del,tau)+phid(del,tau);
	*dfdt=tau*phitt(del,tau)+phit(del,tau)+del*phidt(del,tau)-spe_enth/(GAS_CONST_STEAM*T_C);
	*dgdd=tau*phidt(del,tau)-phid(del,tau);
	*dgdt=tau*phitt(del,tau);
//	printf("QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ%lf,%lf,%lf,%lf,%lf,%lf\n",tau,del,phit(del,tau),phi(del,tau),spe_entr,*g);
}

int pres_tr_r3(double* pres, double temp, double dens)
{
	double tau,del;
	tau=T_C/temp;
	del=dens/r_c;
	*pres=dens*GAS_CONST_STEAM*temp*del*phid(del,tau);
	return 0;
}

int tr_hs_r3(double* temp, double* dens, double spe_enth, double spe_entr)
{
	double ff,gg,dfdd,dfdt,dgdd,dgdt,tau_prev,tau_nxt,del_prev,del_nxt;
	double ptemp,ttemp,dtemp;
	double tau_ini[13]={
		1.038427345,1.006135427,0.975791299,0.947223889,0.92028159,0.894829565,0.870747494,0.847927668,0.826273383,0.805697566,0.786121606,0.767474352,0.749691247,
	};
	double del_ini=1;
	double dd,dt,dmax;	
	int i=0;
	int ii=0,flag=0;
	do
	{
		calcFG_DFG_hs(&ff,&gg,&dfdd,&dgdd,&dfdt,&dgdt,spe_enth,spe_entr,del_ini,tau_ini[ii]);
		if(fabs(dfdd*dgdt-dgdd*dfdt)<ZERO)
		{
			ii++;
			continue;
		}
		dt=(gg*dfdd-ff*dgdd)/(dgdd*dfdt-dfdd*dgdt);
		dd=(gg*dfdt-ff*dgdt)/(dgdt*dfdd-dgdd*dfdt);
		tau_nxt=tau_ini[ii]+dt;
		del_nxt=del_ini+dd; 
//		printf("\n%lf,,,,%lf\n",dt,dd);
		do
		{
			flag=0;
			tau_prev=tau_nxt;
			del_prev=del_nxt;
			calcFG_DFG_hs(&ff,&gg,&dfdd,&dgdd,&dfdt,&dgdt,spe_enth,spe_entr,del_prev,tau_prev);
//			printf("\n\nwwww%lf\n",dfdd*dgdt-dgdd*dfdt);
			if(fabs(dfdd*dgdt-dgdd*dfdt)<ZERO)
			{
				flag=-1;
				break;
			}
//			printf("\n%lf\n%lf\n%lf\n%lf\n",gg,dfdd,ff,dgdd);
			dt=(gg*dfdd-ff*dgdd)/(dgdd*dfdt-dfdd*dgdt);
			dd=(gg*dfdt-ff*dgdt)/(dgdt*dfdd-dgdd*dfdt);
			tau_nxt=tau_prev+dt;
			del_nxt=del_prev+dd; 
			i++;
//			printf("11111111111111%lf,%lf\n",dt,dd);
			if(fabs(dt)>fabs(dd))
				dmax=fabs(dt);
			else
				dmax=fabs(dd);
//				printf("!!!%lf!!!!\n",dmax);
		}while(dmax>ZERO&&i<MAX_ITER_TIMES);
//		printf("\n\n[[[[[%d\t%d\n",i,flag);
		if(i==MAX_ITER_TIMES||flag==-1)
		{
			ii++;
			continue;
		}
		else
		{
			if(!isnan(tau_nxt)&&!isnan(del_nxt))
			{
				ttemp=T_C/tau_nxt;
				dtemp=r_c*del_nxt;
				pres_tr_r3(&ptemp,ttemp,dtemp);
				if(region(ptemp,ttemp)!=3)
				{
					ii++;
					continue;
				}
				else
				{
					*temp=ttemp;
					*dens=dtemp;
					return 0;
				}
			}
			ii++;
			continue;
		}
	}while(ii<13);
	return -1;
}

void calcFd_DFd_th(double* fd, double* dfd, double temp, double spe_enth, double del)
{
	double tau=T_C/temp;
	*fd=tau*phit(del,tau)+del*phid(del,tau)-spe_enth*tau/(GAS_CONST_STEAM*T_C);
	*dfd=tau*phidt(del,tau)+del*phidd(del,tau)+phid(del,tau);
}
int dens_th_r3(double* dens, double temp, double spe_enth)
{
	double fd,dfd,del_ini,del_prev,del_nxt;
	int i=0;
	del_ini=1;
	
	calcFd_DFd_th(&fd,&dfd,temp,spe_enth,del_ini);
	del_nxt=del_ini-fd/dfd;
	do
	{
		del_prev=del_nxt;
		calcFd_DFd_th(&fd,&dfd,temp,spe_enth,del_prev);
		del_nxt=del_prev-fd/dfd;
		i++;
	}while(i<MAX_ITER_TIMES&&fabs(del_nxt-del_prev)>1e-8);
	if(i==MAX_ITER_TIMES)
	{
		*dens=-1;
		return -1;
	} 
	else
	{
		*dens=del_nxt*r_c;
		return 0;
	}
}

int pres_th_r3(double* pres, double temp, double spe_enth)
{
	double dens,del,tau;
	int flag;
	flag=dens_th_r3(&dens,temp,spe_enth);

	if(flag==-1)
	{
		return -1;
	}
	else
	{
		del=dens/r_c;
		tau=T_C/temp;
		*pres=dens*GAS_CONST_STEAM*temp*del*phid(del,tau);
		return 0;
	}
}

int pt_hs_r3(double* pres, double* temp, double spe_enth, double spe_entr)
{
	double tempr3,dens,presr3;
	int flag;
	flag=tr_hs_r3(&tempr3,&dens,spe_enth,spe_entr);
//	printf("\n###############################%.8lf,%.8lf\n",tempr3,dens);
	if(flag==-1)
	{
		*pres=-1;
		*temp=-1;
		return -1;
	}
	flag=pres_th_r3(&presr3,tempr3,spe_enth);
	if(flag==-1)
	{
		*pres=-1;
		*temp=-1;
		return -1;
	}
	*pres=presr3;
	*temp=tempr3;
	return 0;
}

void calcFd_DFd_tu(double* fd, double* dfd, double temp, double spe_ener, double del)
{
	double tau=T_C/temp;
	*fd=phit(del,tau)-spe_ener/(GAS_CONST_STEAM*T_C);
	*dfd=phidt(del,tau);
}
int dens_tu_r3(double* dens, double temp, double spe_ener)
{
	double fd,dfd,del_ini,del_prev,del_nxt;
	int i=0;
	del_ini=1;
	
	calcFd_DFd_tu(&fd,&dfd,temp,spe_ener,del_ini);
	del_nxt=del_ini-fd/dfd;
	do
	{
		del_prev=del_nxt;
		calcFd_DFd_tu(&fd,&dfd,temp,spe_ener,del_prev);
		del_nxt=del_prev-fd/dfd;
		i++;
	}while(i<MAX_ITER_TIMES&&fabs(del_nxt-del_prev)>1e-8);
	if(i==MAX_ITER_TIMES)
	{
		*dens=-1;
		return -1;
	} 
	else
	{
		*dens=del_nxt*r_c;
		return 0;
	}
}

int pres_tu_r3(double* pres, double temp, double spe_ener)
{
	double dens,del;
	int flag;
	flag=dens_tu_r3(&dens,temp,spe_ener);
	if(flag==-1)
	{
		return -1;
	}
	else
	{
		del=dens/r_c;
		*pres=dens*GAS_CONST_STEAM*temp*del*phid(del,T_C/temp);
		return 0;
	}
}

void calcFd_DFd_ts(double* fd, double* dfd, double temp, double spe_entr, double del)
{
	double tau=T_C/temp;
	*fd=tau*phit(del,tau)-phi(del,tau)-spe_entr/GAS_CONST_STEAM;
	*dfd=tau*phidt(del,tau)-phid(del,tau);
}

int dens_ts_r3(double* dens, double temp, double spe_entr)
{
	double fd,dfd,del_ini,del_prev,del_nxt;
	int i=0;
	del_ini=1;
	
	calcFd_DFd_ts(&fd,&dfd,temp,spe_entr,del_ini);
	del_nxt=del_ini-fd/dfd;
	do
	{
		del_prev=del_nxt;
		calcFd_DFd_ts(&fd,&dfd,temp,spe_entr,del_prev);
		del_nxt=del_prev-fd/dfd;
		i++;
	}while(i<MAX_ITER_TIMES&&fabs(del_nxt-del_prev)>1e-8);
	if(i==MAX_ITER_TIMES)
	{
		*dens=-1;
		return -1;
	} 
	else
	{
		*dens=del_nxt*r_c;
		return 0;
	}
}

int pres_ts_r3(double* pres, double temp, double spe_entr)
{
	double dens,del;
	int flag;
	flag=dens_ts_r3(&dens,temp,spe_entr);
	if(flag==-1)
	{
		return -1;
	}
	else
	{
		del=dens/r_c;
		*pres=dens*GAS_CONST_STEAM*temp*del*phid(del,T_C/temp);
		return 0;
	}
}

int steam_prop_calc_r3(double pressure, double temp, steam_prop* p_prop)
{
	double tau=647.096/temp;
	double spe_vol;
	double del,hp_dens;
	int hp_dens_flag,i;
	double dens_ini[10]={
		10,50,100,200,300,400,500,800,1000,1500
	};
	
	spe_vol=spe_vol_pt(pressure,temp);
	if(fabs(spe_vol+1)<ZERO)
	{
		i=0;
		do{
			hp_dens_flag=hp_dens_pt(&hp_dens,dens_ini[i],pressure,temp);
			i++;
		}while(hp_dens_flag==-1&&i<10);
		if(i==10||isnan(hp_dens)||hp_dens<0)
			return -1;
		else
		{
			p_prop->dens=hp_dens;
		}
	} 
	
	else
	{
		hp_dens_flag=hp_dens_pt(&hp_dens,1/spe_vol,pressure,temp);
		if(hp_dens_flag==0)
			p_prop->dens=hp_dens;
		else
			p_prop->dens=1/spe_vol;
	}
	
	r3prop_calc_tr(temp,p_prop->dens,p_prop);	
	return 0;
}